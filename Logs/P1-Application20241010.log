2024-10-10 11:04:06.548 -05:00 [INF] Starting up...
2024-10-10 11:04:07.659 -05:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE `p1database`;
2024-10-10 11:04:07.786 -05:00 [INF] Executed DbCommand (49ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `__EFMigrationsHistory` (
    `MigrationId` varchar(150) CHARACTER SET utf8mb4 NOT NULL,
    `ProductVersion` varchar(32) CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK___EFMigrationsHistory` PRIMARY KEY (`MigrationId`)
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:07.812 -05:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='p1database' AND TABLE_NAME='__EFMigrationsHistory';
2024-10-10 11:04:07.824 -05:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2024-10-10 11:04:07.841 -05:00 [INF] Applying migration '20240913173512_InitialCreate'.
2024-10-10 11:04:07.886 -05:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER DATABASE CHARACTER SET utf8mb4;
2024-10-10 11:04:07.932 -05:00 [INF] Executed DbCommand (45ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetRoles` (
    `Id` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `Name` varchar(256) CHARACTER SET utf8mb4 NULL,
    `NormalizedName` varchar(256) CHARACTER SET utf8mb4 NULL,
    `ConcurrencyStamp` longtext CHARACTER SET utf8mb4 NULL,
    CONSTRAINT `PK_AspNetRoles` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:07.979 -05:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUsers` (
    `Id` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `DiscordId` int NOT NULL,
    `UserName` varchar(256) CHARACTER SET utf8mb4 NULL,
    `NormalizedUserName` varchar(256) CHARACTER SET utf8mb4 NULL,
    `Email` varchar(256) CHARACTER SET utf8mb4 NULL,
    `NormalizedEmail` varchar(256) CHARACTER SET utf8mb4 NULL,
    `EmailConfirmed` tinyint(1) NOT NULL,
    `PasswordHash` longtext CHARACTER SET utf8mb4 NULL,
    `SecurityStamp` longtext CHARACTER SET utf8mb4 NULL,
    `ConcurrencyStamp` longtext CHARACTER SET utf8mb4 NULL,
    `PhoneNumber` longtext CHARACTER SET utf8mb4 NULL,
    `PhoneNumberConfirmed` tinyint(1) NOT NULL,
    `TwoFactorEnabled` tinyint(1) NOT NULL,
    `LockoutEnd` datetime(6) NULL,
    `LockoutEnabled` tinyint(1) NOT NULL,
    `AccessFailedCount` int NOT NULL,
    CONSTRAINT `PK_AspNetUsers` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:08.050 -05:00 [INF] Executed DbCommand (67ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetRoleClaims` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `RoleId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `ClaimType` longtext CHARACTER SET utf8mb4 NULL,
    `ClaimValue` longtext CHARACTER SET utf8mb4 NULL,
    CONSTRAINT `PK_AspNetRoleClaims` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_AspNetRoleClaims_AspNetRoles_RoleId` FOREIGN KEY (`RoleId`) REFERENCES `AspNetRoles` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:08.106 -05:00 [INF] Executed DbCommand (53ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUserClaims` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `ClaimType` longtext CHARACTER SET utf8mb4 NULL,
    `ClaimValue` longtext CHARACTER SET utf8mb4 NULL,
    CONSTRAINT `PK_AspNetUserClaims` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_AspNetUserClaims_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:08.156 -05:00 [INF] Executed DbCommand (47ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUserLogins` (
    `LoginProvider` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `ProviderKey` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `ProviderDisplayName` longtext CHARACTER SET utf8mb4 NULL,
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK_AspNetUserLogins` PRIMARY KEY (`LoginProvider`, `ProviderKey`),
    CONSTRAINT `FK_AspNetUserLogins_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:08.206 -05:00 [INF] Executed DbCommand (48ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUserRoles` (
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `RoleId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK_AspNetUserRoles` PRIMARY KEY (`UserId`, `RoleId`),
    CONSTRAINT `FK_AspNetUserRoles_AspNetRoles_RoleId` FOREIGN KEY (`RoleId`) REFERENCES `AspNetRoles` (`Id`) ON DELETE CASCADE,
    CONSTRAINT `FK_AspNetUserRoles_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:08.249 -05:00 [INF] Executed DbCommand (41ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `AspNetUserTokens` (
    `UserId` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `LoginProvider` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `Name` varchar(255) CHARACTER SET utf8mb4 NOT NULL,
    `Value` longtext CHARACTER SET utf8mb4 NULL,
    CONSTRAINT `PK_AspNetUserTokens` PRIMARY KEY (`UserId`, `LoginProvider`, `Name`),
    CONSTRAINT `FK_AspNetUserTokens_AspNetUsers_UserId` FOREIGN KEY (`UserId`) REFERENCES `AspNetUsers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:08.283 -05:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetRoleClaims_RoleId` ON `AspNetRoleClaims` (`RoleId`);
2024-10-10 11:04:08.315 -05:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX `RoleNameIndex` ON `AspNetRoles` (`NormalizedName`);
2024-10-10 11:04:08.353 -05:00 [INF] Executed DbCommand (36ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetUserClaims_UserId` ON `AspNetUserClaims` (`UserId`);
2024-10-10 11:04:08.387 -05:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetUserLogins_UserId` ON `AspNetUserLogins` (`UserId`);
2024-10-10 11:04:08.424 -05:00 [INF] Executed DbCommand (35ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetUserRoles_RoleId` ON `AspNetUserRoles` (`RoleId`);
2024-10-10 11:04:08.460 -05:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `EmailIndex` ON `AspNetUsers` (`NormalizedEmail`);
2024-10-10 11:04:08.492 -05:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX `UserNameIndex` ON `AspNetUsers` (`NormalizedUserName`);
2024-10-10 11:04:08.500 -05:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20240913173512_InitialCreate', '8.0.8');
2024-10-10 11:04:08.504 -05:00 [INF] Applying migration '20240917165953_addresulrulecondition'.
2024-10-10 11:04:08.572 -05:00 [INF] Executed DbCommand (47ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Conditions` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Description` longtext CHARACTER SET utf8mb4 NOT NULL,
    CONSTRAINT `PK_Conditions` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:08.610 -05:00 [INF] Executed DbCommand (36ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Results` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Description` longtext CHARACTER SET utf8mb4 NOT NULL,
    `CreatedAt` datetime(6) NOT NULL,
    `UpdatedAt` datetime(6) NOT NULL,
    CONSTRAINT `PK_Results` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:08.650 -05:00 [INF] Executed DbCommand (38ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Rules` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Description` longtext CHARACTER SET utf8mb4 NOT NULL,
    `IsEnabled` tinyint(1) NOT NULL,
    `CreatedAt` datetime(6) NOT NULL,
    `UpdatedAt` datetime(6) NOT NULL,
    CONSTRAINT `PK_Rules` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:08.699 -05:00 [INF] Executed DbCommand (46ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `ConditionRule` (
    `ConditionsId` int NOT NULL,
    `RulesId` int NOT NULL,
    CONSTRAINT `PK_ConditionRule` PRIMARY KEY (`ConditionsId`, `RulesId`),
    CONSTRAINT `FK_ConditionRule_Conditions_ConditionsId` FOREIGN KEY (`ConditionsId`) REFERENCES `Conditions` (`Id`) ON DELETE CASCADE,
    CONSTRAINT `FK_ConditionRule_Rules_RulesId` FOREIGN KEY (`RulesId`) REFERENCES `Rules` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:08.750 -05:00 [INF] Executed DbCommand (48ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `ResultRule` (
    `ResultsId` int NOT NULL,
    `RulesId` int NOT NULL,
    CONSTRAINT `PK_ResultRule` PRIMARY KEY (`ResultsId`, `RulesId`),
    CONSTRAINT `FK_ResultRule_Results_ResultsId` FOREIGN KEY (`ResultsId`) REFERENCES `Results` (`Id`) ON DELETE CASCADE,
    CONSTRAINT `FK_ResultRule_Rules_RulesId` FOREIGN KEY (`RulesId`) REFERENCES `Rules` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:08.784 -05:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_ConditionRule_RulesId` ON `ConditionRule` (`RulesId`);
2024-10-10 11:04:08.818 -05:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_ResultRule_RulesId` ON `ResultRule` (`RulesId`);
2024-10-10 11:04:08.827 -05:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20240917165953_addresulrulecondition', '8.0.8');
2024-10-10 11:04:08.831 -05:00 [INF] Applying migration '20240926165822_refinedForRulesSystem'.
2024-10-10 11:04:08.888 -05:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP PROCEDURE IF EXISTS `POMELO_BEFORE_DROP_PRIMARY_KEY`;
CREATE PROCEDURE `POMELO_BEFORE_DROP_PRIMARY_KEY`(IN `SCHEMA_NAME_ARGUMENT` VARCHAR(255), IN `TABLE_NAME_ARGUMENT` VARCHAR(255))
BEGIN
	DECLARE HAS_AUTO_INCREMENT_ID TINYINT(1);
	DECLARE PRIMARY_KEY_COLUMN_NAME VARCHAR(255);
	DECLARE PRIMARY_KEY_TYPE VARCHAR(255);
	DECLARE SQL_EXP VARCHAR(1000);
	SELECT COUNT(*)
		INTO HAS_AUTO_INCREMENT_ID
		FROM `information_schema`.`COLUMNS`
		WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
			AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
			AND `Extra` = 'auto_increment'
			AND `COLUMN_KEY` = 'PRI'
			LIMIT 1;
	IF HAS_AUTO_INCREMENT_ID THEN
		SELECT `COLUMN_TYPE`
			INTO PRIMARY_KEY_TYPE
			FROM `information_schema`.`COLUMNS`
			WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
				AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
				AND `COLUMN_KEY` = 'PRI'
			LIMIT 1;
		SELECT `COLUMN_NAME`
			INTO PRIMARY_KEY_COLUMN_NAME
			FROM `information_schema`.`COLUMNS`
			WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
				AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
				AND `COLUMN_KEY` = 'PRI'
			LIMIT 1;
		SET SQL_EXP = CONCAT('ALTER TABLE `', (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA())), '`.`', TABLE_NAME_ARGUMENT, '` MODIFY COLUMN `', PRIMARY_KEY_COLUMN_NAME, '` ', PRIMARY_KEY_TYPE, ' NOT NULL;');
		SET @SQL_EXP = SQL_EXP;
		PREPARE SQL_EXP_EXECUTE FROM @SQL_EXP;
		EXECUTE SQL_EXP_EXECUTE;
		DEALLOCATE PREPARE SQL_EXP_EXECUTE;
	END IF;
END;
2024-10-10 11:04:08.908 -05:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP PROCEDURE IF EXISTS `POMELO_AFTER_ADD_PRIMARY_KEY`;
CREATE PROCEDURE `POMELO_AFTER_ADD_PRIMARY_KEY`(IN `SCHEMA_NAME_ARGUMENT` VARCHAR(255), IN `TABLE_NAME_ARGUMENT` VARCHAR(255), IN `COLUMN_NAME_ARGUMENT` VARCHAR(255))
BEGIN
	DECLARE HAS_AUTO_INCREMENT_ID INT(11);
	DECLARE PRIMARY_KEY_COLUMN_NAME VARCHAR(255);
	DECLARE PRIMARY_KEY_TYPE VARCHAR(255);
	DECLARE SQL_EXP VARCHAR(1000);
	SELECT COUNT(*)
		INTO HAS_AUTO_INCREMENT_ID
		FROM `information_schema`.`COLUMNS`
		WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
			AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
			AND `COLUMN_NAME` = COLUMN_NAME_ARGUMENT
			AND `COLUMN_TYPE` LIKE '%int%'
			AND `COLUMN_KEY` = 'PRI';
	IF HAS_AUTO_INCREMENT_ID THEN
		SELECT `COLUMN_TYPE`
			INTO PRIMARY_KEY_TYPE
			FROM `information_schema`.`COLUMNS`
			WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
				AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
				AND `COLUMN_NAME` = COLUMN_NAME_ARGUMENT
				AND `COLUMN_TYPE` LIKE '%int%'
				AND `COLUMN_KEY` = 'PRI';
		SELECT `COLUMN_NAME`
			INTO PRIMARY_KEY_COLUMN_NAME
			FROM `information_schema`.`COLUMNS`
			WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
				AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
				AND `COLUMN_NAME` = COLUMN_NAME_ARGUMENT
				AND `COLUMN_TYPE` LIKE '%int%'
				AND `COLUMN_KEY` = 'PRI';
		SET SQL_EXP = CONCAT('ALTER TABLE `', (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA())), '`.`', TABLE_NAME_ARGUMENT, '` MODIFY COLUMN `', PRIMARY_KEY_COLUMN_NAME, '` ', PRIMARY_KEY_TYPE, ' NOT NULL AUTO_INCREMENT;');
		SET @SQL_EXP = SQL_EXP;
		PREPARE SQL_EXP_EXECUTE FROM @SQL_EXP;
		EXECUTE SQL_EXP_EXECUTE;
		DEALLOCATE PREPARE SQL_EXP_EXECUTE;
	END IF;
END;
2024-10-10 11:04:08.927 -05:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `ConditionRule` DROP FOREIGN KEY `FK_ConditionRule_Conditions_ConditionsId`;
2024-10-10 11:04:08.946 -05:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `ConditionRule` DROP FOREIGN KEY `FK_ConditionRule_Rules_RulesId`;
2024-10-10 11:04:08.963 -05:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `ResultRule` DROP FOREIGN KEY `FK_ResultRule_Rules_RulesId`;
2024-10-10 11:04:09.144 -05:00 [INF] Executed DbCommand (179ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CALL POMELO_BEFORE_DROP_PRIMARY_KEY(NULL, 'Rules');
ALTER TABLE `Rules` DROP PRIMARY KEY;
2024-10-10 11:04:09.322 -05:00 [INF] Executed DbCommand (176ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CALL POMELO_BEFORE_DROP_PRIMARY_KEY(NULL, 'Conditions');
ALTER TABLE `Conditions` DROP PRIMARY KEY;
2024-10-10 11:04:09.357 -05:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Rules` RENAME `Rule`;
2024-10-10 11:04:09.387 -05:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Conditions` RENAME `Condition`;
2024-10-10 11:04:09.464 -05:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Results` MODIFY COLUMN `Description` longtext CHARACTER SET utf8mb4 NULL;
2024-10-10 11:04:09.491 -05:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Results` ADD `CreatedBy` int NOT NULL DEFAULT 0;
2024-10-10 11:04:09.516 -05:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Results` ADD `UpdatedBy` int NOT NULL DEFAULT 0;
2024-10-10 11:04:09.543 -05:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Results` ADD `Value` longtext CHARACTER SET utf8mb4 NOT NULL;
2024-10-10 11:04:09.659 -05:00 [INF] Executed DbCommand (113ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUsers` MODIFY COLUMN `DiscordId` bigint unsigned NOT NULL;
2024-10-10 11:04:09.689 -05:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUsers` ADD `UserId` int NOT NULL DEFAULT 0;
2024-10-10 11:04:09.774 -05:00 [INF] Executed DbCommand (82ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Rule` MODIFY COLUMN `Description` longtext CHARACTER SET utf8mb4 NULL;
2024-10-10 11:04:09.794 -05:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Rule` ADD `CreatedBy` int NOT NULL DEFAULT 0;
2024-10-10 11:04:09.818 -05:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Rule` ADD `UpdatedBy` int NOT NULL DEFAULT 0;
2024-10-10 11:04:09.896 -05:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Condition` MODIFY COLUMN `Description` longtext CHARACTER SET utf8mb4 NULL;
2024-10-10 11:04:09.922 -05:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Condition` ADD `CreatedAt` datetime(6) NOT NULL DEFAULT '0001-01-01 00:00:00';
2024-10-10 11:04:09.944 -05:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Condition` ADD `CreatedBy` int NOT NULL DEFAULT 0;
2024-10-10 11:04:09.971 -05:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Condition` ADD `UpdatedAt` datetime(6) NOT NULL DEFAULT '0001-01-01 00:00:00';
2024-10-10 11:04:09.991 -05:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Condition` ADD `UpdatedBy` int NOT NULL DEFAULT 0;
2024-10-10 11:04:10.153 -05:00 [INF] Executed DbCommand (159ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Rule` ADD CONSTRAINT `PK_Rule` PRIMARY KEY (`Id`);
CALL POMELO_AFTER_ADD_PRIMARY_KEY(NULL, 'Rule', 'Id');
2024-10-10 11:04:10.311 -05:00 [INF] Executed DbCommand (156ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Condition` ADD CONSTRAINT `PK_Condition` PRIMARY KEY (`Id`);
CALL POMELO_AFTER_ADD_PRIMARY_KEY(NULL, 'Condition', 'Id');
2024-10-10 11:04:10.350 -05:00 [INF] Executed DbCommand (37ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Item` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Description` longtext CHARACTER SET utf8mb4 NULL,
    `CreatedAt` datetime(6) NOT NULL,
    `CreatedBy` int NOT NULL,
    `UpdatedAt` datetime(6) NOT NULL,
    `UpdatedBy` int NOT NULL,
    CONSTRAINT `PK_Item` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:10.389 -05:00 [INF] Executed DbCommand (36ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Triggers` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Description` longtext CHARACTER SET utf8mb4 NOT NULL,
    `IsEnabled` tinyint(1) NOT NULL,
    `CreatedAt` datetime(6) NOT NULL,
    `CreatedBy` int NOT NULL,
    `UpdatedAt` datetime(6) NOT NULL,
    `UpdatedBy` int NOT NULL,
    CONSTRAINT `PK_Triggers` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:10.428 -05:00 [INF] Executed DbCommand (37ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Users` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `DiscordId` bigint unsigned NOT NULL,
    `CreatedAt` datetime(6) NOT NULL,
    `CreatedBy` int NOT NULL,
    `UpdatedAt` datetime(6) NOT NULL,
    `UpdatedBy` int NOT NULL,
    CONSTRAINT `PK_Users` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:10.478 -05:00 [INF] Executed DbCommand (47ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `RuleTrigger` (
    `RulesId` int NOT NULL,
    `TriggersId` int NOT NULL,
    CONSTRAINT `PK_RuleTrigger` PRIMARY KEY (`RulesId`, `TriggersId`),
    CONSTRAINT `FK_RuleTrigger_Rule_RulesId` FOREIGN KEY (`RulesId`) REFERENCES `Rule` (`Id`) ON DELETE CASCADE,
    CONSTRAINT `FK_RuleTrigger_Triggers_TriggersId` FOREIGN KEY (`TriggersId`) REFERENCES `Triggers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:10.552 -05:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `UserItem` (
    `UserId` int NOT NULL,
    `ItemId` int NOT NULL,
    `CreatedAt` datetime(6) NOT NULL,
    `CreatedBy` int NOT NULL,
    `UpdatedAt` datetime(6) NOT NULL,
    `UpdatedBy` int NOT NULL,
    CONSTRAINT `PK_UserItem` PRIMARY KEY (`UserId`, `ItemId`),
    CONSTRAINT `FK_UserItem_Item_ItemId` FOREIGN KEY (`ItemId`) REFERENCES `Item` (`Id`) ON DELETE CASCADE,
    CONSTRAINT `FK_UserItem_Users_UserId` FOREIGN KEY (`UserId`) REFERENCES `Users` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:10.600 -05:00 [INF] Executed DbCommand (46ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `UserMetaData` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `UserId` int NOT NULL,
    `CreatedAt` datetime(6) NOT NULL,
    `CreatedBy` int NOT NULL,
    `UpdatedAt` datetime(6) NOT NULL,
    `UpdatedBy` int NOT NULL,
    CONSTRAINT `PK_UserMetaData` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_UserMetaData_Users_UserId` FOREIGN KEY (`UserId`) REFERENCES `Users` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2024-10-10 11:04:10.636 -05:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_AspNetUsers_UserId` ON `AspNetUsers` (`UserId`);
2024-10-10 11:04:10.666 -05:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_RuleTrigger_TriggersId` ON `RuleTrigger` (`TriggersId`);
2024-10-10 11:04:10.697 -05:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_UserItem_ItemId` ON `UserItem` (`ItemId`);
2024-10-10 11:04:10.734 -05:00 [INF] Executed DbCommand (36ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_UserMetaData_UserId` ON `UserMetaData` (`UserId`);
2024-10-10 11:04:10.881 -05:00 [INF] Executed DbCommand (144ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUsers` ADD CONSTRAINT `FK_AspNetUsers_Users_UserId` FOREIGN KEY (`UserId`) REFERENCES `Users` (`Id`) ON DELETE CASCADE;
2024-10-10 11:04:10.996 -05:00 [INF] Executed DbCommand (114ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `ConditionRule` ADD CONSTRAINT `FK_ConditionRule_Condition_ConditionsId` FOREIGN KEY (`ConditionsId`) REFERENCES `Condition` (`Id`) ON DELETE CASCADE;
2024-10-10 11:04:11.094 -05:00 [INF] Executed DbCommand (96ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `ConditionRule` ADD CONSTRAINT `FK_ConditionRule_Rule_RulesId` FOREIGN KEY (`RulesId`) REFERENCES `Rule` (`Id`) ON DELETE CASCADE;
2024-10-10 11:04:11.187 -05:00 [INF] Executed DbCommand (91ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `ResultRule` ADD CONSTRAINT `FK_ResultRule_Rule_RulesId` FOREIGN KEY (`RulesId`) REFERENCES `Rule` (`Id`) ON DELETE CASCADE;
2024-10-10 11:04:11.195 -05:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20240926165822_refinedForRulesSystem', '8.0.8');
2024-10-10 11:04:11.206 -05:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP PROCEDURE `POMELO_BEFORE_DROP_PRIMARY_KEY`;
2024-10-10 11:04:11.217 -05:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP PROCEDURE `POMELO_AFTER_ADD_PRIMARY_KEY`;
2024-10-10 11:04:11.313 -05:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='p1database' AND TABLE_NAME='__EFMigrationsHistory';
2024-10-10 11:04:11.325 -05:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='p1database' AND TABLE_NAME='__EFMigrationsHistory';
2024-10-10 11:04:11.332 -05:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2024-10-10 11:04:11.338 -05:00 [INF] No migrations were applied. The database is already up to date.
2024-10-10 11:29:56.803 -05:00 [INF] Starting up...
2024-10-10 11:29:57.799 -05:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='p1database' AND TABLE_NAME='__EFMigrationsHistory';
2024-10-10 11:29:57.825 -05:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='p1database' AND TABLE_NAME='__EFMigrationsHistory';
2024-10-10 11:29:57.840 -05:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2024-10-10 11:29:57.853 -05:00 [INF] No migrations were applied. The database is already up to date.
2024-10-10 11:30:42.776 -05:00 [INF] Starting up...
2024-10-10 11:30:43.789 -05:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='p1database' AND TABLE_NAME='__EFMigrationsHistory';
2024-10-10 11:30:43.813 -05:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='p1database' AND TABLE_NAME='__EFMigrationsHistory';
2024-10-10 11:30:43.829 -05:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2024-10-10 11:30:43.842 -05:00 [INF] Applying migration '20241010162958_UpdadatedForRuleEngineAndOrgs'.
2024-10-10 11:30:43.928 -05:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP PROCEDURE IF EXISTS `POMELO_BEFORE_DROP_PRIMARY_KEY`;
CREATE PROCEDURE `POMELO_BEFORE_DROP_PRIMARY_KEY`(IN `SCHEMA_NAME_ARGUMENT` VARCHAR(255), IN `TABLE_NAME_ARGUMENT` VARCHAR(255))
BEGIN
	DECLARE HAS_AUTO_INCREMENT_ID TINYINT(1);
	DECLARE PRIMARY_KEY_COLUMN_NAME VARCHAR(255);
	DECLARE PRIMARY_KEY_TYPE VARCHAR(255);
	DECLARE SQL_EXP VARCHAR(1000);
	SELECT COUNT(*)
		INTO HAS_AUTO_INCREMENT_ID
		FROM `information_schema`.`COLUMNS`
		WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
			AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
			AND `Extra` = 'auto_increment'
			AND `COLUMN_KEY` = 'PRI'
			LIMIT 1;
	IF HAS_AUTO_INCREMENT_ID THEN
		SELECT `COLUMN_TYPE`
			INTO PRIMARY_KEY_TYPE
			FROM `information_schema`.`COLUMNS`
			WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
				AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
				AND `COLUMN_KEY` = 'PRI'
			LIMIT 1;
		SELECT `COLUMN_NAME`
			INTO PRIMARY_KEY_COLUMN_NAME
			FROM `information_schema`.`COLUMNS`
			WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
				AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
				AND `COLUMN_KEY` = 'PRI'
			LIMIT 1;
		SET SQL_EXP = CONCAT('ALTER TABLE `', (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA())), '`.`', TABLE_NAME_ARGUMENT, '` MODIFY COLUMN `', PRIMARY_KEY_COLUMN_NAME, '` ', PRIMARY_KEY_TYPE, ' NOT NULL;');
		SET @SQL_EXP = SQL_EXP;
		PREPARE SQL_EXP_EXECUTE FROM @SQL_EXP;
		EXECUTE SQL_EXP_EXECUTE;
		DEALLOCATE PREPARE SQL_EXP_EXECUTE;
	END IF;
END;
2024-10-10 11:30:43.948 -05:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP PROCEDURE IF EXISTS `POMELO_AFTER_ADD_PRIMARY_KEY`;
CREATE PROCEDURE `POMELO_AFTER_ADD_PRIMARY_KEY`(IN `SCHEMA_NAME_ARGUMENT` VARCHAR(255), IN `TABLE_NAME_ARGUMENT` VARCHAR(255), IN `COLUMN_NAME_ARGUMENT` VARCHAR(255))
BEGIN
	DECLARE HAS_AUTO_INCREMENT_ID INT(11);
	DECLARE PRIMARY_KEY_COLUMN_NAME VARCHAR(255);
	DECLARE PRIMARY_KEY_TYPE VARCHAR(255);
	DECLARE SQL_EXP VARCHAR(1000);
	SELECT COUNT(*)
		INTO HAS_AUTO_INCREMENT_ID
		FROM `information_schema`.`COLUMNS`
		WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
			AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
			AND `COLUMN_NAME` = COLUMN_NAME_ARGUMENT
			AND `COLUMN_TYPE` LIKE '%int%'
			AND `COLUMN_KEY` = 'PRI';
	IF HAS_AUTO_INCREMENT_ID THEN
		SELECT `COLUMN_TYPE`
			INTO PRIMARY_KEY_TYPE
			FROM `information_schema`.`COLUMNS`
			WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
				AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
				AND `COLUMN_NAME` = COLUMN_NAME_ARGUMENT
				AND `COLUMN_TYPE` LIKE '%int%'
				AND `COLUMN_KEY` = 'PRI';
		SELECT `COLUMN_NAME`
			INTO PRIMARY_KEY_COLUMN_NAME
			FROM `information_schema`.`COLUMNS`
			WHERE `TABLE_SCHEMA` = (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA()))
				AND `TABLE_NAME` = TABLE_NAME_ARGUMENT
				AND `COLUMN_NAME` = COLUMN_NAME_ARGUMENT
				AND `COLUMN_TYPE` LIKE '%int%'
				AND `COLUMN_KEY` = 'PRI';
		SET SQL_EXP = CONCAT('ALTER TABLE `', (SELECT IFNULL(SCHEMA_NAME_ARGUMENT, SCHEMA())), '`.`', TABLE_NAME_ARGUMENT, '` MODIFY COLUMN `', PRIMARY_KEY_COLUMN_NAME, '` ', PRIMARY_KEY_TYPE, ' NOT NULL AUTO_INCREMENT;');
		SET @SQL_EXP = SQL_EXP;
		PREPARE SQL_EXP_EXECUTE FROM @SQL_EXP;
		EXECUTE SQL_EXP_EXECUTE;
		DEALLOCATE PREPARE SQL_EXP_EXECUTE;
	END IF;
END;
2024-10-10 11:30:43.978 -05:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUsers` DROP FOREIGN KEY `FK_AspNetUsers_Users_UserId`;
2024-10-10 11:30:43.998 -05:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `ConditionRule` DROP FOREIGN KEY `FK_ConditionRule_Condition_ConditionsId`;
2024-10-10 11:30:44.014 -05:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `ConditionRule` DROP FOREIGN KEY `FK_ConditionRule_Rule_RulesId`;
2024-10-10 11:30:44.031 -05:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `ResultRule` DROP FOREIGN KEY `FK_ResultRule_Rule_RulesId`;
2024-10-10 11:30:44.047 -05:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `RuleTrigger` DROP FOREIGN KEY `FK_RuleTrigger_Rule_RulesId`;
2024-10-10 11:30:44.062 -05:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `UserItem` DROP FOREIGN KEY `FK_UserItem_Item_ItemId`;
2024-10-10 11:30:44.080 -05:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `UserItem` DROP FOREIGN KEY `FK_UserItem_Users_UserId`;
2024-10-10 11:30:44.105 -05:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `UserMetaData` DROP FOREIGN KEY `FK_UserMetaData_Users_UserId`;
2024-10-10 11:30:44.131 -05:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE `Users`;
2024-10-10 11:30:44.234 -05:00 [INF] Executed DbCommand (100ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CALL POMELO_BEFORE_DROP_PRIMARY_KEY(NULL, 'UserItem');
ALTER TABLE `UserItem` DROP PRIMARY KEY;
2024-10-10 11:30:44.426 -05:00 [INF] Executed DbCommand (190ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CALL POMELO_BEFORE_DROP_PRIMARY_KEY(NULL, 'Rule');
ALTER TABLE `Rule` DROP PRIMARY KEY;
2024-10-10 11:30:44.590 -05:00 [INF] Executed DbCommand (162ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CALL POMELO_BEFORE_DROP_PRIMARY_KEY(NULL, 'Item');
ALTER TABLE `Item` DROP PRIMARY KEY;
2024-10-10 11:30:44.767 -05:00 [INF] Executed DbCommand (175ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CALL POMELO_BEFORE_DROP_PRIMARY_KEY(NULL, 'Condition');
ALTER TABLE `Condition` DROP PRIMARY KEY;
2024-10-10 11:30:44.790 -05:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Results` DROP COLUMN `Value`;
2024-10-10 11:30:44.824 -05:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUsers` DROP COLUMN `DiscordId`;
2024-10-10 11:30:44.851 -05:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `UserItem` RENAME `UserItems`;
2024-10-10 11:30:44.882 -05:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Rule` RENAME `Rules`;
2024-10-10 11:30:44.909 -05:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Item` RENAME `Items`;
2024-10-10 11:30:44.937 -05:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Condition` RENAME `Conditions`;
2024-10-10 11:30:44.958 -05:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `UserMetaData` RENAME COLUMN `UserId` TO `DiscordUserId`;
2024-10-10 11:30:44.979 -05:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `UserMetaData` RENAME INDEX `IX_UserMetaData_UserId` TO `IX_UserMetaData_DiscordUserId`;
2024-10-10 11:30:45.015 -05:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUsers` RENAME COLUMN `UserId` TO `DiscordUserId`;
2024-10-10 11:30:45.041 -05:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUsers` RENAME INDEX `IX_AspNetUsers_UserId` TO `IX_AspNetUsers_DiscordUserId`;
2024-10-10 11:30:45.059 -05:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `UserItems` RENAME INDEX `IX_UserItem_ItemId` TO `IX_UserItems_ItemId`;
2024-10-10 11:30:45.140 -05:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Triggers` MODIFY COLUMN `Description` longtext CHARACTER SET utf8mb4 NULL;
2024-10-10 11:30:45.161 -05:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `UserItems` ADD `DiscordUserId` int NOT NULL DEFAULT 0;
2024-10-10 11:30:45.188 -05:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `UserItems` ADD `Quantity` int NOT NULL DEFAULT 0;
2024-10-10 11:30:45.209 -05:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Items` ADD `Type` longtext CHARACTER SET utf8mb4 NULL;
2024-10-10 11:30:45.236 -05:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Conditions` ADD `ExpectedResult` longtext CHARACTER SET utf8mb4 NOT NULL;
2024-10-10 11:30:45.257 -05:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Conditions` ADD `ExpectedValue` longtext CHARACTER SET utf8mb4 NOT NULL;
2024-10-10 11:30:45.280 -05:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Conditions` ADD `Operation` longtext CHARACTER SET utf8mb4 NOT NULL;
2024-10-10 11:30:45.363 -05:00 [INF] Executed DbCommand (81ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `UserItems` ADD CONSTRAINT `PK_UserItems` PRIMARY KEY (`UserId`, `ItemId`);
2024-10-10 11:30:45.516 -05:00 [INF] Executed DbCommand (151ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Rules` ADD CONSTRAINT `PK_Rules` PRIMARY KEY (`Id`);
CALL POMELO_AFTER_ADD_PRIMARY_KEY(NULL, 'Rules', 'Id');
2024-10-10 11:30:45.668 -05:00 [INF] Executed DbCommand (150ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Items` ADD CONSTRAINT `PK_Items` PRIMARY KEY (`Id`);
CALL POMELO_AFTER_ADD_PRIMARY_KEY(NULL, 'Items', 'Id');
2024-10-10 11:30:45.844 -05:00 [INF] Executed DbCommand (175ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Conditions` ADD CONSTRAINT `PK_Conditions` PRIMARY KEY (`Id`);
CALL POMELO_AFTER_ADD_PRIMARY_KEY(NULL, 'Conditions', 'Id');
2024-10-10 11:30:45.891 -05:00 [INF] Executed DbCommand (45ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `ItemResults` (
    `ItemId` int NOT NULL,
    `ResultId` int NOT NULL,
    `Quantity` int NOT NULL,
    `CreatedAt` datetime(6) NOT NULL,
    `CreatedBy` int NOT NULL,
    `UpdatedAt` datetime(6) NOT NULL,
    `UpdatedBy` int NOT NULL,
    CONSTRAINT `PK_ItemResults` PRIMARY KEY (`ItemId`, `ResultId`),
    CONSTRAINT `FK_ItemResults_Items_ItemId` FOREIGN KEY (`ItemId`) REFERENCES `Items` (`Id`) ON DELETE CASCADE,
    CONSTRAINT `FK_ItemResults_Results_ResultId` FOREIGN KEY (`ResultId`) REFERENCES `Results` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2024-10-10 11:30:45.933 -05:00 [INF] Executed DbCommand (39ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `DiscordUsers` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `DiscordId` bigint unsigned NOT NULL,
    `GameId` int NULL,
    `TeamId` int NULL,
    `CreatedAt` datetime(6) NOT NULL,
    `CreatedBy` int NOT NULL,
    `UpdatedAt` datetime(6) NOT NULL,
    `UpdatedBy` int NOT NULL,
    CONSTRAINT `PK_DiscordUsers` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2024-10-10 11:30:45.974 -05:00 [INF] Executed DbCommand (38ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Games` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Description` longtext CHARACTER SET utf8mb4 NOT NULL,
    `TeamId` int NULL,
    `CreatedAt` datetime(6) NOT NULL,
    `CreatedBy` int NOT NULL,
    `UpdatedAt` datetime(6) NOT NULL,
    `UpdatedBy` int NOT NULL,
    CONSTRAINT `PK_Games` PRIMARY KEY (`Id`)
) CHARACTER SET=utf8mb4;
2024-10-10 11:30:46.030 -05:00 [INF] Executed DbCommand (53ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Organization` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Description` longtext CHARACTER SET utf8mb4 NOT NULL,
    `TeamId` int NOT NULL,
    `DiscordUserId` int NOT NULL,
    `CreatedAt` datetime(6) NOT NULL,
    `CreatedBy` int NOT NULL,
    `UpdatedAt` datetime(6) NOT NULL,
    `UpdatedBy` int NOT NULL,
    CONSTRAINT `PK_Organization` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_Organization_DiscordUsers_DiscordUserId` FOREIGN KEY (`DiscordUserId`) REFERENCES `DiscordUsers` (`Id`) ON DELETE CASCADE
) CHARACTER SET=utf8mb4;
2024-10-10 11:30:46.088 -05:00 [INF] Executed DbCommand (55ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE `Team` (
    `Id` int NOT NULL AUTO_INCREMENT,
    `Name` longtext CHARACTER SET utf8mb4 NOT NULL,
    `Description` longtext CHARACTER SET utf8mb4 NOT NULL,
    `TeamLeaderId` int NOT NULL,
    `CurrentGameId` int NOT NULL,
    `OrganizationId` int NULL,
    `CreatedAt` datetime(6) NOT NULL,
    `CreatedBy` int NOT NULL,
    `UpdatedAt` datetime(6) NOT NULL,
    `UpdatedBy` int NOT NULL,
    CONSTRAINT `PK_Team` PRIMARY KEY (`Id`),
    CONSTRAINT `FK_Team_Organization_OrganizationId` FOREIGN KEY (`OrganizationId`) REFERENCES `Organization` (`Id`)
) CHARACTER SET=utf8mb4;
2024-10-10 11:30:46.116 -05:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_UserItems_DiscordUserId` ON `UserItems` (`DiscordUserId`);
2024-10-10 11:30:46.156 -05:00 [INF] Executed DbCommand (38ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_DiscordUsers_GameId` ON `DiscordUsers` (`GameId`);
2024-10-10 11:30:46.187 -05:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_DiscordUsers_TeamId` ON `DiscordUsers` (`TeamId`);
2024-10-10 11:30:46.213 -05:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Games_TeamId` ON `Games` (`TeamId`);
2024-10-10 11:30:46.245 -05:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_ItemResults_ResultId` ON `ItemResults` (`ResultId`);
2024-10-10 11:30:46.278 -05:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Organization_DiscordUserId` ON `Organization` (`DiscordUserId`);
2024-10-10 11:30:46.302 -05:00 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Organization_TeamId` ON `Organization` (`TeamId`);
2024-10-10 11:30:46.332 -05:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX `IX_Team_OrganizationId` ON `Team` (`OrganizationId`);
2024-10-10 11:30:46.503 -05:00 [INF] Executed DbCommand (168ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `AspNetUsers` ADD CONSTRAINT `FK_AspNetUsers_DiscordUsers_DiscordUserId` FOREIGN KEY (`DiscordUserId`) REFERENCES `DiscordUsers` (`Id`) ON DELETE CASCADE;
2024-10-10 11:30:46.597 -05:00 [INF] Executed DbCommand (93ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `ConditionRule` ADD CONSTRAINT `FK_ConditionRule_Conditions_ConditionsId` FOREIGN KEY (`ConditionsId`) REFERENCES `Conditions` (`Id`) ON DELETE CASCADE;
2024-10-10 11:30:46.694 -05:00 [INF] Executed DbCommand (96ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `ConditionRule` ADD CONSTRAINT `FK_ConditionRule_Rules_RulesId` FOREIGN KEY (`RulesId`) REFERENCES `Rules` (`Id`) ON DELETE CASCADE;
2024-10-10 11:30:46.793 -05:00 [INF] Executed DbCommand (97ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `ResultRule` ADD CONSTRAINT `FK_ResultRule_Rules_RulesId` FOREIGN KEY (`RulesId`) REFERENCES `Rules` (`Id`) ON DELETE CASCADE;
2024-10-10 11:30:46.891 -05:00 [INF] Executed DbCommand (96ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `RuleTrigger` ADD CONSTRAINT `FK_RuleTrigger_Rules_RulesId` FOREIGN KEY (`RulesId`) REFERENCES `Rules` (`Id`) ON DELETE CASCADE;
2024-10-10 11:30:46.994 -05:00 [INF] Executed DbCommand (101ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `UserItems` ADD CONSTRAINT `FK_UserItems_DiscordUsers_DiscordUserId` FOREIGN KEY (`DiscordUserId`) REFERENCES `DiscordUsers` (`Id`) ON DELETE CASCADE;
2024-10-10 11:30:47.107 -05:00 [INF] Executed DbCommand (111ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `UserItems` ADD CONSTRAINT `FK_UserItems_Items_ItemId` FOREIGN KEY (`ItemId`) REFERENCES `Items` (`Id`) ON DELETE CASCADE;
2024-10-10 11:30:47.204 -05:00 [INF] Executed DbCommand (96ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `UserMetaData` ADD CONSTRAINT `FK_UserMetaData_DiscordUsers_DiscordUserId` FOREIGN KEY (`DiscordUserId`) REFERENCES `DiscordUsers` (`Id`) ON DELETE CASCADE;
2024-10-10 11:30:47.315 -05:00 [INF] Executed DbCommand (109ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `DiscordUsers` ADD CONSTRAINT `FK_DiscordUsers_Games_GameId` FOREIGN KEY (`GameId`) REFERENCES `Games` (`Id`);
2024-10-10 11:30:47.421 -05:00 [INF] Executed DbCommand (104ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `DiscordUsers` ADD CONSTRAINT `FK_DiscordUsers_Team_TeamId` FOREIGN KEY (`TeamId`) REFERENCES `Team` (`Id`);
2024-10-10 11:30:47.516 -05:00 [INF] Executed DbCommand (93ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Games` ADD CONSTRAINT `FK_Games_Team_TeamId` FOREIGN KEY (`TeamId`) REFERENCES `Team` (`Id`);
2024-10-10 11:30:47.623 -05:00 [INF] Executed DbCommand (106ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE `Organization` ADD CONSTRAINT `FK_Organization_Team_TeamId` FOREIGN KEY (`TeamId`) REFERENCES `Team` (`Id`) ON DELETE CASCADE;
2024-10-10 11:30:47.633 -05:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20241010162958_UpdadatedForRuleEngineAndOrgs', '8.0.8');
2024-10-10 11:30:47.645 -05:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP PROCEDURE `POMELO_BEFORE_DROP_PRIMARY_KEY`;
2024-10-10 11:30:47.656 -05:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP PROCEDURE `POMELO_AFTER_ADD_PRIMARY_KEY`;
2024-10-10 11:30:47.725 -05:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='p1database' AND TABLE_NAME='__EFMigrationsHistory';
2024-10-10 11:30:47.739 -05:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='p1database' AND TABLE_NAME='__EFMigrationsHistory';
2024-10-10 11:30:47.745 -05:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2024-10-10 11:30:47.749 -05:00 [INF] No migrations were applied. The database is already up to date.
